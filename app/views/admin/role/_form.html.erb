<%= form_with(model: role, url: url, method: url_method) do |f| %>
  <input type="hidden" id="role_h" name="role_h" value="new">
  <% if role.errors.any? %>
    <div class="error_explanation alert_error">
      <div class="icon_error_explanation">
        <i class="icon-shield"></i>
      </div>
      <div class="data_error_explanation">
        <h1 class="d-flex justify-content-center"><i class="bi bi-exclamation-octagon text-danger"></i></h1>
        <h4><%= pluralize(role.errors.count, "errores") %> prohíben que se salve la información:</h4>

        <ul>
          <% role.errors.each do |error| %>
            <li class="text-danger"><%= error.message %></li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <div class="row">
    <div class="col-xl-12">
      <div class="form-group">
        <%= f.label :is_default, class: 'mt-2 mb-1 small form-inline' do %>
          <%= f.check_box :is_default %> <span class="ml-2">Role por defecto</span>
        <% end %>
      </div>
      <div class="form-group">
        <%= f.label :admin_access, class: 'mt-2 mb-1 small form-inline' do %>
          <%= f.check_box :admin_access %> <span class="ml-2">Acceso a la administración</span>
        <% end %>
      </div>
      <div class="form-group">
        <label class="small mb-1" for="text">Prioridad:</label>
        <%= f.text_field :priority, class: 'form-control' %>
      </div>
      <div class="form-group">
        <label class="small mb-1" for="text">Role:</label>
        <%= f.text_field :role_type, class: 'form-control' %>
      </div>
      <% if role.accesses.present? %>
        <table class="table table-bordered table-hover table-condensed mt-3 table-responsive-md">
          <tr>
            <th><input type="checkbox" id="check_all" class="mb-2"></th>
            <th>Permiso</th>
            <th>Mostrar <input type="checkbox" id="check_all_show"></th>
            <th>Crear <input type="checkbox" id="check_all_create"></th>
            <th>Editar <input type="checkbox" id="check_all_edit"></th>
            <th>Eliminar <input type="checkbox" id="check_all_delete"></th>
            <th>Otras Acciones <input type="checkbox" id="check_all_other_actions"></th>
          </tr>
          <%= f.fields_for :accesses do |access| %>
            <tr>
              <td>
                <input type="checkbox" data-check="row_<%= access.index %>" onchange="check_row(this);"></td>
              <td>
                <% if view == 'new' %>
                  <%= access.hidden_field :permissions_id, value: permission[access.index].id %>
                  <%= permission[access.index].name %>
                <% else %>
                  <%= access.hidden_field :permissions_id, value: permission[access.index].permission.id %>
                  <%= permission[access.index].permission.name %>
                <% end %>
              </td>
              <td>
                <%= access.label :can_show, class: 'mb-1 small form-inline' do %>
                  <%= access.check_box :can_show, class: "check check_show row_#{access.index}" %>
                  <span class="ml-2">Mostrar</span>
                <% end %>
              </td>
              <td>
                <%= access.label :can_create, class: 'mb-1 small form-inline' do %>
                  <%= access.check_box :can_create, class: "check check_create row_#{access.index}" %>
                  <span class="ml-2">Crear</span>
                <% end %>
              </td>
              <td>
                <%= access.label :can_edit, class: 'mb-1 small form-inline' do %>
                  <%= access.check_box :can_edit, class: "check check_edit row_#{access.index}" %>
                  <span class="ml-2">Editar</span>
                <% end %>
              </td>
              <td>
                <%= access.label :can_delete, class: 'mb-1 small form-inline' do %>
                  <%= access.check_box :can_delete, class: "check check_delete row_#{access.index}" %>
                  <span class="ml-2">Eliminar</span>
                <% end %>
              </td>
              <td>
                <%= access.label :can_other, class: 'mb-1 small form-inline' do %>
                  <%= access.check_box :can_other, class: "check check_other_actions row_#{access.index}" %>
                  <span class="ml-2">Otras acciones</span>
                <% end %>
              </td>
            </tr>
          <% end %>
        </table>
      <% end %>

      <div class="form-group mt-3 d-flex justify-content-end" style="gap: .5em;">
        <%= link_to admin_roles_path, class: 'btn btn-secondary mb-3' do %>
          <span class="icon-arrow-left"></span> Atrás
        <% end %>
        <!-- Save changes button-->
        <button class="btn btn-success mb-3" name="commit" type="submit"><span class="icon-check  "></span> Guardar
        </button>
      </div>
    </div>
  </div>
<% end %>

<script type="text/javascript" charset="utf-8">

    function check_row(e) {
        let check = $(`.${e.dataset.check}`);
        check.prop('checked', $(e).is(':checked'));
    }

    $(document).ready(function () {
        let check_all = $('#check_all');
        let check_all_show = $('#check_all_show');
        let check_all_create = $('#check_all_create');
        let check_all_edit = $('#check_all_edit');
        let check_all_delete = $('#check_all_delete');
        let check_all_other_actions = $('#check_all_other_actions');
        let check = $('.check');
        let check_show = $('.check_show');
        let check_create = $('.check_create');
        let check_edit = $('.check_edit');
        let check_delete = $('.check_delete');
        let check_other_actions = $('.check_other_actions');

        check_all.on('change', function () {
            check.prop('checked', $(this).is(':checked'));
        })
        check_all_show.on('change', function () {
            check_show.prop('checked', $(this).is(':checked'));
        })
        check_all_create.on('change', function () {
            check_create.prop('checked', $(this).is(':checked'));
        })
        check_all_edit.on('change', function () {
            check_edit.prop('checked', $(this).is(':checked'));
        })
        check_all_delete.on('change', function () {
            check_delete.prop('checked', $(this).is(':checked'));
        })
        check_all_other_actions.on('change', function () {
            check_other_actions.prop('checked', $(this).is(':checked'));
        })
    })
</script>